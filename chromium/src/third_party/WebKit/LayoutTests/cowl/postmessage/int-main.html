<!DOCTYPE html>
<html>
<body>
<script src="../../resources/testharness.js"></script>
<script src="../../resources/testharnessreport.js"></script>
<iframe></iframe>
<script>

var iframe = document.querySelector('iframe');

async_test(t => {
    iframe.onload = t.step_func(() => {
      var lobj = new LabeledObject({obj: 5});
      iframe.contentWindow.postMessage(lobj, '*');
      //iframe.contentWindow.postMessage('hello', '*');
      });

    window.addEventListener('message', t.step_func(e => {
      assert_unreached('Message should be dropped by COWL');
      }));

    // Success on timeout: message to iframe dropped by COWL
     t.step_timeout(() => { t.done(); }, 2000);

    iframe.src = 'int-iframe.html';
    }, 'Testing Integrity PostMessage');

</script>
</body>
</html>
